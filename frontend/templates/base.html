<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bank of Mahishmathi{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <!-- Bootstrap CSS -->
    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'favicon.png' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Intro Animation Overlay -->
    <div id="intro-overlay">
        <div class="intro-brand">üè¶ Bank of Mahishmathi</div>
        <div class="intro-sub">Trust ‚Ä¢ Security ‚Ä¢ Legacy</div>
    </div>
    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <!-- Global Toast Container -->
    <div class="toast-container" id="toast-container">
        {% if messages %}
        {% for message in messages %}
        <div class="toast {{ message.tags }}">
            {% if message.tags == 'success' %}
            <i class="bi bi-check-circle-fill text-success" style="font-size: 1.2rem;"></i>
            {% elif message.tags == 'error' %}
            <i class="bi bi-x-circle-fill text-danger" style="font-size: 1.2rem;"></i>
            {% elif message.tags == 'warning' %}
            <i class="bi bi-exclamation-triangle-fill text-warning" style="font-size: 1.2rem;"></i>
            {% else %}
            <i class="bi bi-info-circle-fill text-info" style="font-size: 1.2rem;"></i>
            {% endif %}
            <span class="toast-message">{{ message|safe }}</span>
            <i class="bi bi-x toast-close" onclick="this.parentElement.remove()"></i>
        </div>
        {% endfor %}
        {% endif %}
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold"
                href="{% if user.is_authenticated %}{% url 'dashboard' %}{% else %}{% url 'landing' %}{% endif %}">Bank
                of Mahishmathi</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                    <li class="nav-item"><a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'deposit' %}">Deposit</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'withdraw' %}">Withdraw</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'transfer' %}">Transfer</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" href="{% url 'profile' %}">{{ user.username }}</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
                    {% else %}
                    <li class="nav-item"><a class="nav-link" href="{% url 'admin:index' %}">Admin Login</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">Sign Up</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        {% block content %}{% endblock %}
    </div>

    <footer class="text-center text-muted">
        <div class="container">
            &copy; 2026 Bank of Mahishmathi. All rights reserved.
        </div>
    </footer>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="{% static 'vendor/bootstrap-icons/css/bootstrap-icons.css' %}">

    <!-- Bootstrap JS -->
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script>
        // Intro Animation Logic
        window.addEventListener('load', function () {
            const overlay = document.getElementById('intro-overlay');
            const hasSeenIntro = sessionStorage.getItem('hasSeenIntro');
            const isLandingPage = window.location.pathname === '/';

            console.log("Page Loaded: " + new Date().toISOString());

            // Intro Animation - Disabled for debugging
            if (overlay) {
                // if (isLandingPage && !hasSeenIntro) {
                //     console.log("Playing intro animation");
                //     setTimeout(() => {
                //         overlay.classList.add('fade-out');
                //         setTimeout(() => overlay.remove(), 1000);
                //     }, 2500);
                //     sessionStorage.setItem('hasSeenIntro', 'true');
                // } else {
                //     console.log("Skipping intro animation");
                overlay.style.display = 'none';
                overlay.remove();
                // }
            }

            var preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 500);
            }
        });

        // Auto-dismiss toasts
        document.addEventListener('DOMContentLoaded', function () {
            const toasts = document.querySelectorAll('.toast');
            toasts.forEach(t => {
                // Auto dismiss after 5 seconds
                setTimeout(() => {
                    dismissToast(t);
                }, 5000);
            });
        });

        function dismissToast(toastElement) {
            toastElement.style.animation = 'slideUpFadeOut 0.5s ease forwards';
            setTimeout(() => {
                if (toastElement.parentElement) toastElement.remove();
            }, 500);
        }

        // Expose for manual closing (though inline onclick handles it mostly)
        window.dismissToast = dismissToast;
    </script>
</body>

</html>